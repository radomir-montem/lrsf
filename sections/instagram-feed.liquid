
{% liquid
  assign access_token = section.settings.token
  assign items_per_rows = section.settings.items_per_rows
  assign images_per_row_desktop = section.settings.images_per_row_desktop
  assign images_per_row_mobile = section.settings.images_per_row_mobile

  assign limit = items_per_rows | times: images_per_row_desktop
  assign limit_on_mobile = items_per_rows | times: images_per_row_mobile
%}

{%- style -%}
  @media screen and (max-width: 768px) {
    #instagram-feed--{{ section.id }} .dbtfy-instagram-feed__container .dbtfy-instagram-feed__column:nth-child({{ limit_on_mobile }}) ~ * {
      display: none;
    }
  }
{%- endstyle -%}

{{ 'instagram.css' | asset_url | stylesheet_tag }}

<script src="{{ 'instafeed.js' | asset_url }}" defer></script>
<script src="{{ 'instagram.js' | asset_url }}" defer></script>

<div class="instagram-feed-template lf-hidden">
  <div class="instagram-feed__column grid--{{ 12 | divided_by: images_per_row_mobile }}-col grid--{{ 12 | divided_by: images_per_row_desktop }}-col-desktop">
    <a
      href="{% raw %}{{link}}{% endraw %}"
      target="_blank"
      class="global-media-settings background-transparent media"
      title="{{ meta_title }}"
      style="padding-bottom: 100%"
    >
      <img loading="lazy" src="{% raw %}{{image}}{% endraw %}">

      <div class="overlay">
        <div class="media-wrapper__content text-center">
          {{- 'icon-instagram.svg' | inline_asset_content -}}
        </div>
      </div>
    </a>
  </div>
</div>

<div class="instagram-feed" id="instagram-feed--{{ section.id }}">
  <div class="page-width">
    {% if section.settings.heading != blank %}
        <header class="section-header">
            <h3 class="section-header__title">
            {{ section.settings.heading }}
            </h3>
        </header>
    {% endif %}
    {% if access_token != blank %}
      <instagram
        class="d-grid instagram-feed__container"
        data-token="{{ access_token }}"
        data-limit="{{ limit }}"
      ></instagram>
    {% endif %}
  </div>
</div>
{% schema %}
    {
        "name": "Instagram Feed",
        "settings": [
            {
                "type": "text",
                "id": "heading",
                "label": "Heading"
            },
            {
                "type": "text",
                "id": "token",
                "label": "Token"
            },
            {
                "type": "range",
                "id": "items_per_rows",
                "label": "Items per rows",
                "default": 1,
                "min": 1,
                "max": 3,
                "step": 1
            },
            {
                "type": "range",
                "id": "images_per_row_desktop",
                "label": "Images per row desktop",
                "default": 6,
                "min": 3,
                "max": 6,
                "step": 1
            },
            {
                "type": "range",
                "id": "images_per_row_mobile",
                "label": "Images per row mobile",
                "default": 3,
                "min": 1,
                "max": 4,
                "step": 1
            }
        ],
        "presets": [
            {
                "name": "Instargram Feed"
            }
        ]
    }
{% endschema %}